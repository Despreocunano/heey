---
export const prerender = true;

import Layout from '../../layouts/Layout.astro';
import DescuentosGrid from '../../components/descuentos/DescuentosGrid.astro';
import { getComercios, getDescuentosByComercio } from '../../lib/contentful';

export async function getStaticPaths() {
  const comercios = await getComercios();
  
  return comercios.map(comercio => ({
    params: { comercioSlug: comercio.slug },
    props: { comercio }
  }));
}

const { comercio } = Astro.props;
const descuentos = await getDescuentosByComercio(comercio.slug);

const breadcrumb = [
  { label: 'Inicio', href: '/' },
  { label: 'Descuentos', href: '/descuentos' },
  { label: comercio.nombre, href: `/descuentos/${comercio.slug}`, current: true }
];
---

<Layout 
  title={`Descuentos en ${comercio.nombre}`}
  description={`Conoce todos los descuentos disponibles en ${comercio.nombre} con tarjetas de crÃ©dito.`}
  breadcrumb={breadcrumb}
>
  <main class="bg-gray-50">
    <div class="max-w-7xl mx-auto px-4 py-12">
      <div class="flex items-center gap-6 mb-12">
        <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
          <img 
            src={comercio.logo.url} 
            alt={comercio.logo.title}
            class="h-16 w-auto object-contain"
          />
        </div>
        <div>
          <h1 class="text-3xl font-bold text-gray-900 mb-2">
            Descuentos en {comercio.nombre}
          </h1>
          <p class="text-gray-600">
            {comercio.descripcion}
          </p>
        </div>
      </div>

      <DescuentosGrid 
        descuentos={descuentos}
        emptyMessage={`No hay descuentos disponibles en ${comercio.nombre} en este momento.`}
      />
    </div>
  </main>
</Layout>