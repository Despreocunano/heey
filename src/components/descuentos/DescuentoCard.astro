---
import type { Descuento } from '../../types/contentful/descuento';

interface Props {
  descuento: Descuento;
}

const { descuento } = Astro.props;

function formatearFecha(fecha: string) {
  return new Date(fecha).toLocaleDateString('es-CL', {
    day: 'numeric',
    month: 'long',
    year: 'numeric'
  });
}
---

<article class="bg-gray-50 rounded-xl shadow-sm hover:shadow-md transition-shadow border border-gray-100">
  <div class="p-6">
    {/* Descuento y Vigencia */}
    <div class="flex items-center justify-between mb-4">
      <div>
        <span class="text-3xl font-bold text-teal-600">
          {descuento.porcentajeDescuento}%
        </span>
        <p class="text-sm text-gray-500">
          de descuento
        </p>
      </div>
      <div class="text-right">
        <p class="text-xs text-gray-500">Válido hasta</p>
        <p class="text-sm font-medium text-gray-900">
          {formatearFecha(descuento.fechaTermino)}
        </p>
      </div>
    </div>

    {/* Detalles del descuento */}
    <div class="space-y-4">
      {/* Tarjetas - limitado a 2 */}
      {descuento.tarjetas && descuento.tarjetas.length > 0 && (
        <div>
          <p class="text-sm font-medium text-gray-700 mb-2">Tarjetas participantes:</p>
          <div class="flex gap-4">
            {descuento.tarjetas.slice(0, 2).map(tarjeta => (
              <a 
                href={`/tarjetas-de-credito/${tarjeta.slug}`}
                class="group relative"
              >
                <img 
                  src={tarjeta.imagenTarjeta.url}
                  alt={tarjeta.nombre}
                  class="h-10 w-auto object-contain transition-transform group-hover:scale-105"
                />
                <div class="absolute inset-0 bg-black opacity-0 group-hover:opacity-10 transition-opacity rounded"></div>
              </a>
            ))}
            {descuento.tarjetas.length > 2 && (
              <span class="text-sm text-gray-500 flex items-center">
                +{descuento.tarjetas.length - 2} más
              </span>
            )}
          </div>
        </div>
      )}

      {/* Bancos */}
      {descuento.bancos && descuento.bancos.length > 0 && (
        <div>
          <p class="text-sm font-medium text-gray-700 mb-2">Bancos participantes:</p>
          <div class="flex flex-wrap gap-3">
            {descuento.bancos.map(banco => (
              <a 
                href={`/banco/${banco.slug}`}
                class="group relative"
              >
                <img 
                  src={banco.logoBanco.url}
                  alt={banco.nombreBanco}
                  class="h-6 w-auto object-contain transition-transform group-hover:scale-105"
                />
                <div class="absolute inset-0 bg-black opacity-0 group-hover:opacity-10 transition-opacity rounded"></div>
              </a>
            ))}
          </div>
        </div>
      )}

      {/* Días y Condiciones */}
      <div class="space-y-3">
        <div>
          <p class="text-sm font-medium text-gray-700 mb-1">Días válidos:</p>
          <div class="flex flex-wrap gap-1">
            {descuento.diasAplicables.map(dia => (
              <span class="text-xs bg-white text-gray-600 px-2 py-1 rounded-md border border-gray-200">
                {dia}
              </span>
            ))}
          </div>
        </div>

        <div>
          <p class="text-sm font-medium text-gray-700 mb-1">Condiciones:</p>
          <p class="text-sm text-gray-600 line-clamp-2">{descuento.condiciones}</p>
          {descuento.topeDescuento && (
            <p class="text-sm font-medium text-gray-900 mt-2">
              Tope: ${descuento.topeDescuento.toLocaleString('es-CL')}
            </p>
          )}
        </div>
      </div>
    </div>
  </div>
</article>

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>